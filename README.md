# Умный FAQ для ********

Мини-сервис для обработки вопросов пользователей с использованием базы знаний компании и LLM.

## Описание задачи

- API-сервис на FastAPI для приёма вопросов и выдачи ответов.
- Загрузка документов (.txt / .md /.pdf) в векторную базу данных.
- Поиск релевантных фрагментов (RAG Pipeline).
- Генерация ответов через OpenAI.
- Кэширование частых вопросов в Redis (TTL 1 час).
- Хранение истории запросов в PostgreSQL.
- Запуск через Docker Compose.

## Установка и запуск

1. Клонировать репозиторий.

2. Создать файл `.env` на основе `.env.example`, заполнить ключи API, настройки БД и Redis.

3. Запустить сервисы через Docker Compose:

docker-compose up --build

4. После запуска:

- API доступно на `http://localhost:8000`

## API

- `POST /api/ask` — принимает текстовый вопрос, возвращает ответ.
- `POST /api/documents` — загрузка документов в базу знаний.
- `GET /api/health` — healthcheck сервиса.
- `GET /api/story` — получить данные из бд по истории запросов.

## Архитектура

- `src/api` — FastAPI API.
- `src/core` — утилиты, логирование и общие модули.
- `src/database` — подключение PostgreSQL
- `migrations/versions` -  миграции PostgreSQL.
- `src/repository` — операции с базой данных.
- `src/service` — бизнес-логика, работа с OpenAI, обработка чанков и RAG pipeline.
- `logs` — логи работы сервиса.
- `tests` — юнит-тесты и интеграционные тесты.

## RAG Pipeline

- Документы разбиваются на чанки.
- Чанки индексируются в векторную базу (ChromaDB).
- При запросе создаётся эмбеддинг вопроса, ищутся релевантные чанки.
- Формируется prompt с найденным контекстом.
- Генерируется ответ через LLM (OpenAI).
- Ответ и метрики сохраняются в PostgreSQL.

## Кэширование

- Redis используется для кеша популярных вопросов.
- TTL кэша — 1 час.




